---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
source("tianfengRwrappers.R")
ds2 <- readRDS("ds2.rds")
selected_features <- read.csv("./datatable/ds2_features.csv", stringsAsFactors = F)
selected_features <- selected_features$Feature
Idents(ds2) <- ds2$seurat_clusters
ggobj <- multi_featureplot(selected_features[1:9], ds2, labels = NULL)
ggsave("ds2_features.png", device = png, height = 8, width = 8, plot = ggobj)
```
## 病变亚群的识别
### LUM
```{r}
sep = 0.3
surfaceplot2("LUM",ds2,x_seq = seq(-2,13, sep), y_seq = seq(2,17,sep))
```

```{r}
surfaceplot2("ACTA2",ds2,x_seq = seq(-2,13, sep), y_seq = seq(2,17,sep))
```

```{r}
surfaceplot2("FB_score1",ds2,x_seq = seq(-2,13, sep), y_seq = seq(2,17,sep),z_height = 2)
```

```{r}
surfaceplot2("SMC_score1",ds2,x_seq = seq(-2,13, sep), y_seq = seq(2,17,sep),z_height = 2)
```


```{r}
dd <- umapplot(ds2,label = F)+scale_y_continuous(limits = c(2,17), breaks = NULL) +
        scale_x_continuous(limits = c(-2,13), breaks = NULL)+ 
  guides(colour = guide_legend(override.aes = list(size = 5))) +
        theme(axis.line = element_blank())
ggsave("dd.png",device = png,height = 4,width = 6,plot= dd, bg = "transparent")

```

#  addmodulescore
```{r}
geneset <- read.table("SMC")
ds2 <- AddModuleScore(ds2,features = geneset, name = 'SMC_score')
f("SMC_score1", ds2, min.cutoff = 0)
# dataset1 <- AddModuleScore_UCell(dataset1,features = geneset, name = 'fibromyo_score')
# f("V1fibromyo_score", dataset1)

geneset <- read.table("FB")
ds2 <- AddModuleScore(ds2,features = geneset, name = 'FB_score')
f("FB_score1", ds2, min.cutoff = 0)
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
